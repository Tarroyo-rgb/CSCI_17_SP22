<!DOCTYPE html>
<html>
<!--This is the title-->
  <head>
    <link rel='stylesheet' href='custom.css'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/themes/prism.min.css'/>
  </head>
  
  <body>
    <h1>Week 12 Lab: Kenobi [THM]</h1>
  
    <p>Summary: “This room will cover accessing a Samba share, manipulating a vulnerable version of proftpd to gain initial access and escalate your privileges to root via an SUID binary.”</p>
    

<!-----------------------------------------Task 1----------------------------------------->

    <h2>Task 1: Deploy the Vulnerable Machine</h2>
    <p>So we need to start an attack box or vm instance and gain access to the target machine which we’ve been provided with the IP.</p>
    <p>Let’s start by running nmap to see what ports are open and what actions are available for us to move forward, while also answering the questions. </p>
    <p>I ran ‘nmap -T4 -A $TARGET_IP’ to get the following results:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>For a more condensed version run ‘nmap -T4 $TARGET_IP’.</p>
    <p>How many ports are open? 7</p>
    
    
<!-----------------------------------------Task 2----------------------------------------->

    <h2>Task 2: Enumerating Samba for Shares</h2>
    
    <p>Samba is a suite of programs that allows Linux/Unix systems to communicate with Windows machines for access to files and other shared resources. This application suite can be enumerated or manipulated to grant access, so that’s exactly what we are going to do here (specifically with an already created script available with nmap.)</p>
    <p>I ran the provided command which runs the pre-made script on port 445 which is one of the two ports Samba uses:</p>
    <pre><code class='language-bash'>nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse $TARGET_IP</code></pre>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>Using the nmap command above, how many shares have been found? 3</p>
    <p>Next, we’ll connect to the machine’s network shares through smbclient which works similarly to ftp.</p>
    <p>We’ll use the anonymous username to connect: <code class='language-bash'>smbclient //$TARGET_IP/anonymous</code>. This will prompt for a password which is the same as the anonymous login when connecting with ftp. We’ll list the files and see only one text file:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>Once you're connected, list the files on the share. What is the file can you see? log.txt</p>
    <p>The file seems to hold some information when analyzed and holds both an SSH key location and information on the ProFTPD Server they use. We can decide to download the file with the cmd: <code class='language-bash'>smbget -R smb://$TARGET_IP/anonymous</code>. Or we can also use the more cmd while still connected with smbclient.</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>What port is FTP running on? 21</p>
    <p>Our attention is being drawn to port 111 which runs the rpcbind service. Apparently, there are scripts to enumerate this service as well as it can commonly be used to get access to network file systems. The following command will run a script for that purpose:</p>
    <pre><code class='language-bash'>nmap -p 111 –script=nfs-ls, nfs-statfs, nfs-showmount $HOST_IP</code></pre>
    <p>We can see which mount is available to us, the files within it and even how much space they take up:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>What mount can we see? /var</p>
    
    
<!-----------------------------------------Task 3----------------------------------------->

    <h2>Task 3: Gain Initial Access with ProFtpd</h2>

    <p>Proftpd is a server used for both Unix and Windows systems and is important to know what version is being used as they can have potential vulnerabilities. We’ll check the version by connecting through FTP. We don’t even need to login with any credentials to see the version number:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>What is the version? 1.3.5</p>
    <p>We can find exploits for this service and specifically the version we just found by using searchsploit.</p>
    <p>Let’s run the following cmd which calls searchsploit, the service/application we want to find exploits for, and the version of the service/application: <code class='language-bash'>searchsploit proftpd 1.3.5</code></p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>We only see three results but THM doesn’t seem to like that answer for the next question, but if we look on exploit-db we find 4 results which is the right answer:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>How many exploits are there for the ProFTPd running? 4</p>
    <p>The room points out that ProFTPd has an exploit for the mod_copy module that can copy all files/directories to a chosen destination and since we found a user’s SSH key we can use the exploit to copy it. </p>
    <p>We’ll connect with netcat through the port used for ProFTPd: <code class='language-bash'>nc $TARGET_IP 21</code></p>
    <p>Once we’ve connected we can use the SITE CPFR and SITE CPTO commands as we know the location of the SSH key from the log.txt file and knowing we have access to the /var/tmp directory we can move it there.</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>[There are two questions that need no answer after learning this information and copying the key. Complete and continue.</p>
    <p>To mount the /var/tmp directory we’ll follow the commands provided by the THM room:</p>
    <pre><code class='language-bash'>
    mkdir /mnt/kenobiNFS
    mount $TARGET_IP:/var /mnt/kenobiNFS
    ls -la /mnt/kenobiNFS
    </code></pre>
    <p>Now that we can see all the files and directories of the target machine, we can access the SSH key to use. We are also provided some helpful commands to copy the file, allow permissions for us to use and connect through SSH:</p>
    <pre><code class='language-bash'>
    cp /mnt/kenobiNFS/tmp/id_rsa .
    sudo chmod 600 id_rsa
    ssh -i id_rsa kenobi@$TARGET_IP
    </code></pre>
    <p>The image below shows the previous three commands as well as showing our connection:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>After roaming the files real quick we find the user.txt and the flag for the question:</p>
    <img src="Images/Lab 12/[1] nmap results.png" alt="img 1" class="center"/>
    <p>What is Kenobi’s user flag (/home/kenobi/user.txt)? D0b0f3f53b6caa532a83915e19224899</p>
    
    
<!-----------------------------------------Task 4----------------------------------------->

    <h2>Task 4: Privilege Escalation with Path Variable Manipulation</h2>
  
  <br>
  <br>

    <p><a href="index.html" title="Home" class="link">Back to Home</a></p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script>
  
  </body>
  
</html>
